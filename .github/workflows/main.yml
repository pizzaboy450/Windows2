name: VMOS Cloud WebDroid Setup

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"  # every 6 hours

jobs:
  webdroid:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      # 1️⃣ Checkout repo (optional if HTML is stored in repo)
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2️⃣ Set up environment variables for VMOS credentials
      - name: Setup credentials
        run: |
          echo "VMOS_USER=${{ secrets.VMOS_USER }}" >> $GITHUB_ENV
          echo "VMOS_PASS=${{ secrets.VMOS_PASS }}" >> $GITHUB_ENV
          echo "VMOS_URL=${{ secrets.VMOS_URL }}" >> $GITHUB_ENV

      # 3️⃣ Generate WebDroid HTML with credentials and iframe
      - name: Generate WebDroid HTML
        run: |
          cat <<EOF > webdroid.html
          <!DOCTYPE html>
          <html lang="en">
          <head>
          <meta charset="UTF-8">
          <title>WebDroid VMOS Cloud</title>
          <style>
          body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh; font-family:sans-serif; }
          #device-container { width:600px; height:1200px; border-radius:40px; background:#111; overflow:hidden; box-shadow:0 0 120px 50px rgba(255,255,255,0.2); transition:all 0.5s ease; }
          iframe { width:100%; height:100%; border:none; }
          #creds { position:fixed; bottom:10px; left:10px; background:rgba(34,34,34,0.85); color:#fff; padding:10px; border-radius:8px; font-size:14px; }
          </style>
          </head>
          <body>
          <div id="device-container">
            <iframe src="\${VMOS_URL}" allowfullscreen></iframe>
          </div>
          <div id="creds">
            <strong>User:</strong> \${VMOS_USER}<br>
            <strong>Pass:</strong> \${VMOS_PASS}
          </div>
          <script>
          const container = document.getElementById('device-container');
          function resizeAndRotate() {
            if(window.innerWidth > window.innerHeight) {
              container.style.width = '1200px';
              container.style.height = '800px';
              container.style.transform='rotate(0deg)';
            } else {
              container.style.width = '600px';
              container.style.height = '1200px';
              container.style.transform='rotate(0deg)';
            }
          }
          window.addEventListener('resize', resizeAndRotate);
          resizeAndRotate();
          </script>
          </body>
          </html>
          EOF

      # 4️⃣ Optionally deploy to GitHub Pages or another static host
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./webdroid.html
